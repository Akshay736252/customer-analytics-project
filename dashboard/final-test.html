<!DOCTYPE html>
<html>
<head>
    <title>Final Dashboard Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 5px; overflow: auto; }
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin: 20px 0; }
        .stat { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat h3 { margin: 0 0 10px 0; font-size: 14px; opacity: 0.9; }
        .stat .value { font-size: 24px; font-weight: bold; }
        button { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #5a67d8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Customer Analytics - Final Test</h1>
        
        <button onclick="testAll()">üîÑ Test All Connections</button>
        
        <div class="stats" id="stats">
            <div class="stat"><h3>Loading...</h3><div class="value">...</div></div>
        </div>
        
        <div class="card" id="results">
            <h2>Test Results:</h2>
            <div id="output">Click test button to start...</div>
        </div>
    </div>

    <script>
        async function testAll() {
            const output = document.getElementById('output');
            const stats = document.getElementById('stats');
            
            output.innerHTML = 'üîÑ Testing API connection...';
            
            try {
                // Test 1: Basic connection
                output.innerHTML += '<br>üì° Testing /api/sales/test...';
                const testRes = await fetch('http://127.0.0.1:8000/api/sales/test');
                const testData = await testRes.json();
                output.innerHTML += ` ‚úÖ (${testData.status})\n`;
                
                // Test 2: Get columns
                output.innerHTML += '<br>üìã Testing /api/sales/columns...';
                const columnsRes = await fetch('http://127.0.0.1:8000/api/sales/columns');
                const columnsData = await columnsRes.json();
                output.innerHTML += ` ‚úÖ (${columnsData.columns?.length || 0} columns)\n`;
                
                // Test 3: Get summary
                output.innerHTML += '<br>üí∞ Testing /api/sales/summary...';
                const summaryRes = await fetch('http://127.0.0.1:8000/api/sales/summary');
                const summaryData = await summaryRes.json();
                
                if (!summaryData.error) {
                    output.innerHTML += ` ‚úÖ\n`;
                    
                    // Update stats
                    stats.innerHTML = `
                        <div class="stat">
                            <h3>Total Revenue</h3>
                            <div class="value">$${(summaryData.total_revenue / 1000000).toFixed(1)}M</div>
                        </div>
                        <div class="stat">
                            <h3>Total Orders</h3>
                            <div class="value">${(summaryData.total_orders / 1000).toFixed(1)}K</div>
                        </div>
                        <div class="stat">
                            <h3>Customers</h3>
                            <div class="value">${(summaryData.unique_customers / 1000).toFixed(1)}K</div>
                        </div>
                        <div class="stat">
                            <h3>Avg Order</h3>
                            <div class="value">$${summaryData.avg_order_value.toFixed(2)}</div>
                        </div>
                    `;
                } else {
                    output.innerHTML += ` ‚ùå (${summaryData.error})\n`;
                }
                
                // Show full data
                output.innerHTML += '\n\nüì¶ Full Response:\n';
                output.innerHTML += '<pre>' + JSON.stringify({
                    test: testData,
                    columns: columnsData,
                    summary: summaryData
                }, null, 2) + '</pre>';
                
            } catch (error) {
                output.innerHTML += `\n‚ùå Error: ${error.message}`;
                output.innerHTML += '\n\nMake sure FastAPI is running on port 8000';
            }
        }
        
        // Auto test on page load
        testAll();
    </script>
</body>
</html>